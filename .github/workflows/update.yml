name: Update YouTube Streams Data

on:
  schedule:
    # â˜€ï¸ 15åˆ†ã”ã¨ã®è»½é‡æ›´æ–°ï¼ˆJST 11:00ã€œç¿Œ2:00 â†’ UTC 2ã€œ17æ™‚ï¼‰
    - cron: "*/15 2-17 * * *"
      env:
        MODE: light

    # ğŸŒ™ å¤œé–“3:30 JSTï¼ˆUTC 18:30ï¼‰ã«å…¨ä»¶ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
    - cron: "30 18 * * *"
      env:
        MODE: full

  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Install dependencies
        run: |
          pip install requests

      - name: âš™ï¸ Run update script
        env:
          YOUTUBE_KEY_MORE: ${{ secrets.YOUTUBE_KEY_MORE }}
          YOUTUBE_KEY_APOLLO: ${{ secrets.YOUTUBE_KEY_APOLLO }}
          YOUTUBE_KEY_MAHO: ${{ secrets.YOUTUBE_KEY_MAHO }}
          YOUTUBE_KEY_BIBI: ${{ secrets.YOUTUBE_KEY_BIBI }}
          YOUTUBE_KEY_RAMU: ${{ secrets.YOUTUBE_KEY_RAMU }}
          YOUTUBE_KEY_PICO: ${{ secrets.YOUTUBE_KEY_PICO }}
          YOUTUBE_KEY_SOCHIMARU: ${{ secrets.YOUTUBE_KEY_SOCHIMARU }}
        run: |
          echo "ğŸš€ Running YouTube update script in mode: ${{ env.MODE }}"
          python update.py --mode=${{ env.MODE }}

      - name: ğŸ’¾ Commit & Push updated JSON
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"
          git add data/streams.json data/streams_backup.json || true
          git commit -m "Auto update streams data (${{ env.MODE }} mode)" || true
          git push
